-공부 문서 제공해주신 분: CUHA-김태원

# 로그 분석 및 파일 관리
## 해킹에 이용된 계정(root 권한을 갖는 계정 찾기)

1. cat /etc/passwd | more
2. git bit가 0으로 설정된 것을 찾는다. root그룹은 항상 0이기 때문.
```
root:x:0:0:root:/root:/bin/bash

```
* 필드 1 : 사용자명
* 필드 2 : 패스워드(/etc/shadow 파일에 암호화 되어있다.)
* 필드 3 : 사용자 계정 uid (User Id)
* 필드 4 : 사용자 계정 gid (Group Id)
* 필드 5 : 사용자 계정 이름 (정보)
* 필드 6 : 사용자 계정 홈 디렉토리
* 필드 7 : 사용자 계정 로그인 쉘

## 해킹에 사용된 파일들(해커의 계정이 소유한 파일들)의 위치 찾기

find / -user (해커의 계정) 2> /dev/null

자세한 내용은 find명령어 정리 참고

## 공격자의 흔적을 지우는데 사용된 파일 찾기

1. 위에서 찾은 해커 소유의 파일들을 cat과 more 명령어를 통해 확인  
ex) cat /tmp/.outkit | more

2. 해커가 root 권한을 얻은 뒤에 수행한 명령어 로그를 확인  
ex) cat ~root/.bash_history

관련 내용은 <로그 파일 경로>에 정리해 두었다.

## 침입자가 권한 상승을 위해 사용한 파일 위치 찾기

위에서 찾은 해커 소유의 파일 중에 cat과 more을 통해  
setreuid(geteuid(), geteuid()); 와 같이 권한 변경 관련 코드가 있는 파일을 찾아낸다.

1. setuid : 프로세스의 ruid, euid, suid를 변경한다(관리자가 root일때만)
2. seteuid : 프로세스의 euid를 변경한다.

핵심: find . -user (유저명) | xargs grep -n setreuid 2> /dev/null
### 참고
* 1>/dev/null은 표준출력을 /dev/null로 redirection하고 (정상적인 메시지를 null로)
* 2>/dev/null은 표준에러를 /dev/null로 redirection 한다 (에러메시지를 null로)

## 인가되지 않은(잘 알려지지 않은) 리모트 백도어 서비스 찾기
1. cd /etc/xinetd.d/
2. ls
3. 일반적으로 쓰이지 않는 서비스가 있는지 확인한다.
chargen, cups, daytime, echo, finger, rexec, rsh, servers, services, sgi_fam, telnet, tftp, time-udp, xadmin
위 목록과 관계없어 보이고 뜬금없다면 그것이 정답일 가능성이 높다.

## 서로 다른 두 파일을 비교하여 변경된 사항 확인하는 방법
diff 또는 cmp를 사용한다.

## 해커의 ip찾기

lastlog -u (계정)

ex> lastlog -u hacker

또는 -t (기간) 명령어를 통해 특정 기간 내의 로그만 확인

ex> lastlog -u hacker -t 3 (최근 3일 동안 hacker계정 접속 로그 출력)

# 계정 설정
## 사용자 계정의 유효기간을 30일로 설정하는 방법

usermod -f 30 cuha(cuha 계정의 유효기간을 30일로 설정)

## 패스워드 변경법

passwd cuha (cuha 계정의 패스워드 변경, 명령어 입력시 새 비밀번호 입력 필드가 생긴다.)

## root 계정에 대한 자동 로그아웃 시간을 50초로 설정하는 법
vi /etc/profile

TMOUT 항목의 값을 50으로 변경, 없다면 인서트 모드로 들어가
```
TMOUT=50
```
을 추가하고 나오기.

## PW 최소 글자 수를 8글자 이상으로 설정하는 방법

vi /etc/login.defs

PASS_MIN_LEN 항목 값을 8로 변경

## PW 유효기간을 30일로 설정하는 방법

vi /etc/login.defs

PASS_MAX_DAYS 항목 값을 30으로 변경

# 네트워크 및 방화벽 설정
## VSFTP 설정 중 anonymous(익명 사용자) 사용 못하게(차단) 하는 설정법

```
vi /etc/vsftpd.conf
anonymous_enable=NO
service vsftp restart(시험엔 나올지 모르겠다, 사용 안할 가능성 높다.)
```
## FTP 인증 실패 시 차단 횟수 설정법
```
vi /etc/ftpaccess
loginfails 3
service vsftp restart(마찬가지로 시험에서는 작성 안해도 될 것 같다.)
```
## IPTABLES 에서 들어오는 패킷 중 icmp 패킷 모두 차단 설정법

iptables -A INPUT -p icmp -j DROP

## sendmail 설정 중 거부하고 싶은 ip address 설정법
```
vi /etc/mail/access
123.123.123.123 REJECT (123.123.123.123 차단)
cd /etc/mail
makemap hash access < access
```
참고로 아이피뒤에 붙이는 옵션은 다음과 같다.
OK : 모두 허용.
RELAY : 수신/발신 허용.
REJECT : 수신/발신 거부.
DISCARD : /etc/sendmail.cf에 지정된 곳으로 메일을 폐기함 (스팸 메일함으로 이동)

## http.conf 설정으로 index파일이 없는 경우 홈 디렉토리가 디렉토리 형태로 안보이게 설정하는 법
```
find / -name httpd.conf 2> /dev/null
vi /위에서 찾은 경로/httpd.conf
Options Indexes FollowSymLinks  -> Options FollowSymLinks
```
# 포트 설정 및 권한 설정
## 인가되지 않은(Well-known 포트가 아닌) 백도어 포트 번호 찾기

1. Well-Known 포트는 1~1024번 포트이다.
2. netstat 명령어를 사용한다. $netstat -nat
3. 포트번호에서 1~1024가 아닌 포트가 비인가 포트이다.
4. netstat -nap 명령을 사용하면 해당 포트를 사용중인 프로세스의 정보를 얻을 수 있다.

## 4000~5000번대 사이의 TCP포트를 열어 LISTEN하고 있다. 해당 포트 찾기

1. netstat -nat | grep LISTEN 명령으로 연결된 모든 TCP 포트 번호를 출력한다.
2. 4000과 5000번 사이의 포트 번호를 찾아 답안에 기술하면 된다.

## 권한 설정하는 방법
chmod 명령어를 사용한다

* r : read : 4
* w : write : 2
* x : excute : 1

위 숫자들을 더한 값으로 사용할 수 있다.

chmod 644 (rw_r__r__) 소유자는 읽기 쓰기 가능, 다른 그룹과 사용자는 읽기만 가능하다.

## /etc/services 파일 설정법

이 파일은 리눅스 서버에서 사용하는 모든 포트들에 대한 정의가 설정되어있다.

설정을 통해 기본 사용 포트를 변경하여 알려진(Well-known)포트를 통해 기본적인 해킹 툴들을 차단할 수 있다.

ex)
서비스명 	 포트/프로토콜 	 별칭  
ftp                21/tcp			* 별칭은 반드시 정해야 하는 것은 아님  
fsp                21/udp 	 fspd  

## 아파치 서버(웹서버)에서 1.2.3.4 ip만을 차단하려고 한다.

1. find / -name httpd.conf 2>/dev/null
2. vi /1에서 찾은 경로/httpd.conf
3. <Directory/>
    Order deny, allow
    Deny from 1.2.3.4
    Allow from all
    </Directory>
4. service httpd restart

## 현재 서버가 sniffing 당하고 있다. 그 근거와 차단 방법은?

1. ifconfig

해당 명령을 통해 현재 promiscuous모드가 활성화 되어있는지 확인한다.
만약 **eth0**:flag=4163<UP,BROADCAST,RUNNING,**PROMISC**,MULTICAST>  
와 같이 PROMISC 라는 문자열이 eth0에 있다면 현재 promiscuous모드이다.

2. ifconfig eth0 -promisc
명령을 통해 promiscuous 모드를 비활성화 한다.

# find, grep 명령어 정리

grep -n 문자열 경로

ex> grep -n hack . (현재 디렉토리에서 hack문자열을 포함하고 있는 파일 검색)

find (검색위치) -(옵션과 인자)

**. 은 현재 디렉토리를, / 는 루트 디렉토리를 의미힌다.

find의 옵션은 다음과 같다.
```
-name 파일명            #디렉토리에서 파일 또는 디렉토리 이름으로 검색
-user 사용자이름        #디렉토리에서 사용자의 소유 파일들을 검색
-name *문자열           #지정된 문자열로 끝나는 파일 검색
-name *문자열*          #지정된 문자열을 포함하는 파일 검색
-name 문자열*           #지정된 문자열로 시작하는 파일 검색
-empty                  #빈 디렉토리 또는 크기가 0인 파일 검색
-name "*.c" -exec ls -l {} \;           #디렉토리에서 C확장자 파일 상세 정보 출력
>-exec 옵션은 외부 함수를 불러온다고 생각하면 된다. 구문은 -exec 명령문 {} \;
2>/dev/null             #에러 메시지를 표시하지 않는다.
```
<로그 파일 경로>
-사용자명/.bash_history : 해당 사용자가 입력했던 명령어들을 기록한 로그, 매우 중요하다.

# <주관식 예상 문제>  (단답형)

**Dos(Denial of Service),DDos(Distributed Denial of Service)**  

서비스 거부 공격으로 시스템을 악의적으로 공격해 해당 시스템의 자원을 부족하게 하여 원래 의도된 용도로  
사용하지 못하게 하는 공격

**스니핑(Sniffing)**

네트워크상에 지나다니는 패킷들을 캡처해서 훔쳐보는 공격기술, 이런 공격기술을 사용하는 툴을 스니퍼라고 한다.(도청장치라고도 볼 수 있다)

**스푸핑(Spoofing:속이다)**

악의적으로 임이의 웹사이트를 구성하여 일반 사용자들의 방문을 유도해 인터넷 프로토콜은 TCP/IP구조적 결함을 이용하여 사용자의 시스템 권한을 획득한 뒤 정보를 빼가는 해킹 방법

**IP Spoofing**  

MAC의 윗 단계인 IP주소를 속이는 방법이다. 다른 이가 사용하는 IP를 강탈해 권한을 획든하는 것으로, IP스푸핑을 통해 Dos도 수행이 가능하다. 공격대상 컴퓨터와 서버사이의 연결된 세션을 끊을 수도 있다.

**DNS Spoofing**

실제 DNS서버보다 빨리 공격 대상에서 DNS 응답 패킷을 보내 공격대상이 잘못된 IP 주소로 웹 접속을 하도록
유도하는 공격이다.

**Buffer Overflow**

메모리에 할당된 버퍼의 양을 초과하는 데이터를 입력하여 프로그램의 복귀 주소(return address)를 조작후
해커가 원하는 코드를 실행하는 공격이다.

**Format String**

포멧 스트링과 이것을 사용하는 printf 함수의 취약점을 이용해 RET위치에 셸 코드의 주소를 읽어 셸을 획득하는 해킹 공격이다.

**VPN (Virtual Private Network)-가상 사설망**

두 개 이상의 물리적 네트워크 또는 장치 사이의 인터넷/공용 네트워크를 통해 생성된 가상 네트워크이다. 인터넷 트래픽을 암호화 하고 온라인상의 신원을 보호할 수 있다.

**스턱스 넷(Stuxnet)**

대단히 정교한 컴퓨터 웜으로, 기존에 알려진 여러가지 윈도우 제로데이 취약점을 이용해 컴퓨터를 감염시키고 확산된다. 

단순이 감염이 되는 것 뿐만아니라 물리적인 피해를 준다.

이란 우라늄 농축 시설 파괴를 위해 사용된 적이 있다.

**트로이 목마**

정상적인 프로그램으로 위장하여 시작부터 끝까지 램에 상주하며 시스템 내부 정보를 공격자의 컴퓨터로 빼돌리는 특징이 있다. 직접 전파가 아닌 주로 웹하드, P2P, 메일 등의 간접식 방식으로 전파된다. 트로이목마가 숨어있는 파일을 설치하는 순간 감염이 진행된다.

**터널링**

데이터 스트림을 인터넷상에서 가상의 파이프를 통해 전달시키는 기술

컴퓨터 네트워크에서 터널링 프로토콜을 사용하면 네트워크 사용자는 기본 네트워크가 직접 제공하지 않는 네트워크 서비스에 접근하거나 제공할 수 있다.

**SSH(Secure Shell)-보안쉘**

원격지 호스트 컴퓨터에 접속하기 위해 사용되는 인터넷 프로토콜, 암호화 기능이 있다.

**SSL(Secure Socket Layer)**

웹사이트와 브라우저(혹은 두서버)사이에 전송된 데이터를 암호화하여 인터넷 연결 보안을 유지하는 표준 기술

**FireWall - 방화벽**

미리 정의된 보안 규칙에 따라 들어오고 나가는 네트워크 트래픽을 모니터링하고 제어하는 네트워크 보안 시스템

**침임 탐지 시스템-IDS(Intrusion Detection System)**

시스템과 네트워크 자원으로부터 비정상적인 사용, 오용, 남용 등에 대한 정보를 실시간으로 수집, 분석하여 *침입 및 침입 시도의 징후를 찾아내고 보고*하는 시스템.

**침임 방지 시스템-IPS(Intrusion Prevention System)**  

-방화벽과 IDS의 장점을 결합하여 만든 보안 솔루션(장비)
-인터넷 웜 등과 같은 악성코드 및 해킹에 기인한 유해 트래픽 차단
-피해를 주기 전에 미리 능동적으로 공격을 차단함으로써 공격 피해를 최소화한다.
-Application의 취약점을 사전에 보완하고 버퍼 오퍼플로우등을 예방한다.
-정상적으로 작동하는 네트워크 트래픽상태를 기억해 두어 비정상적인 트래픽이 발생할 때 이를 기반으로
알려지지 않은 공격까지 차단

**침입 탐지 시스템 vs 침입 방지 시스템**

IDS는 탐지에 목적을 두고 있어 사후 조치하지만, IPS는 사전 예방을 목적에 두고있다.
IDS와 다르게 IPS에서는 트래픽이 IPS를 거쳐야만 유통 가능하다.

**XSS(Cross Site Scripting)**

웹 어플리케이션에서 사용자 입력값에 대한 필터링이 제대로 이루어지지 않을 경우, 공격자가 입력이 가능한 폼에 악의적인 스크립트를 삽입하여 해당 스크립가 희생자 측에서 동작하도록하여 악의적인 행위를 수행하는 공격
!SQL 인젝션과 혼동하지 말 것. 스크립트와 폼과 같은 키워드를 기억해둘 필요가 있다.

**Exploit-취약점**

취약점 공격 또는 익스플로잇(Exploit)이란 컴퓨터의 소프트웨어나 하드웨어 및 컴퓨터 관련 전자 제품의 버그, 보안 취약점등 설계상 결함을 이용해 공격자의 의도된 동작을 수행하도록 만들어진 절차나 일련의 명령, 스크립트, 프로그램 또는 특정한 데이터 조각을 말한다. 이러한 것들을 사용한 공격 행위를 이르기도 한다.

**Honeypoy**  

컴퓨터프로그램에 침입한 스팸과 컴퓨터 바이러스, 크래커를 탐지하는 하나의 개별 시스템  
침입자를 속이는 침입 탐지기법으로 마치 실제로 공격을 당하는 것처럼 보이게 하여 크래커를 추적하고 정보를 수집함.

침입자를 오래 머물게 하여 추적이 가능하므로 능동적으로 방어할 수 있고, 침입자의 공격을 차단할 수 있다는 장점때문에 많이 활용되고 있음

**Nmap**

고든 라이온이 작성한 보안 스캐너

컴퓨터와 서비스를 찾을 때 쓰이며, 네트워크 지도를 함께 만든다.

다른 간단한 포트 스캐너들 처럼, Nmap은 서비스 탐지 프로토콜로 자신을 광고하지 않는 수동적인 서비스들도 찾아낼 수 있다.

Nmap은 원격 컴퓨터들의 자세한 정보를 알아낼 수 있다. 이 상세 정보에는 운영체제, 장치 종류, 운영시간 근거리 네트워크에서 네트워크 카드의 공급자 등을 포함한다.

# 주관식 예상 문제 (서술형)
<SQL injection>

설명 :
SQL injection은 코드 인젝션의 한 기법으로 클라이언트의 입력값을 조작하여 서버의 데이터베이스를 공격할 수 있는 공격방식을 말함. 입력받는 데이터(문자열)를 제대로 필터링하지 못한 경우에 발생

<Land Attack>

설명 :
출발지와 목적지의 IP 주소를 모두 공격자의 IP로 설정해 호스트를 루프 상태에 빠지게 만들어 IP 프로토콜 스택에 심각한 장애를 유발하고, 컴퓨터에 부하를 발생시키는 공격.


대응방안 :
라우터나 패킷 필터링 도구를 이용하여 네트워크로 유입되는 패킷 중에서 source 주소가 내부 IP인 패킷을 차단한다.


<Ping of Death>

설명 :
1. Ping을 이용하여 ICMP 패킷을 정상 크기보다 크게 생성한다.
2. 전송된 패킷은 네트워크를 통해 라우팅(Routing)되어 공격 네트워크에 도달하는 동안 아주 작은 조각(Fragment)이 된다.
3. 공격대상 시스템은 이렇게 작게 조각화된 패킷을 모두 처리해야 하므로 정상적인 Ping의 경우보다 훨씬 많은 부하가 걸리게 되고, 시스템 성능이 저하된다.


대응방안 :
ICMP Ping에 대해 응답을 하지 않도록 설정한다.

ex)
iptables -A INPUT -p icmp –j DROP

<SYN Flooding>

설명 :
TCP 프로토콜의 연결 설정을 위하여 3-Way Handshaking의 취약점을 이용하여 실현되는 서비스 거부 공격


대응방안 :
SYN Received의 대기시간을 줄인다.

<Null Session>

설명 :
Null session은 임의의 사용자가 네트워크를 통해 별도의 인증 없이 사용자 이름이나 
공유 정보 등을 수집할 수 있는 메커니즘으로, 윈도우 탐색기가 원격 서버에 있는 
공유 자원들을 열거할 때와 같이 응용프로그램에 의해 사용된다.


대응방안 :
레지스트리에서 Null session 공유에 대한 허용을 하지 않도록 변경한다.